<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.iocoder.yudao.module.bus.dal.mysql.busindex.BusIndexMapper">

    <!--
        一般情况下，尽可能使用 Mapper 进行 CRUD 增删改查即可。
        无法满足的场景，例如说多表关联查询，才使用 XML 编写 SQL。
        代码生成器暂时只生成 Mapper XML 文件本身，更多推荐 MybatisX 快速开发插件来生成查询。
        文档可见：https://www.iocoder.cn/MyBatis/x-plugins/
     -->
    <select id="selectPageList" resultType="cn.iocoder.yudao.module.bus.controller.admin.energyconsumption.VO.BusAisleBarQueryVO">
        SELECT bi.id as id, bi.dev_key as devKey, bi.ip_addr as ipAddr, bi.cas_addr as casAddr, bi.bar_id as barId, bi.run_status as runStatus,
        bi.node_ip as nodeIp, bi.bus_name as busName, bi.is_deleted as isDeleted, bi.create_time as createTime, bi.update_time as updateTime,
        ab.path as path, ab.aisle_id as aisleId,ab.bar_key as barKey,ab.dev_ip as devIp
        FROM bus_index  bi LEFT JOIN aisle_bar ab on bi.dev_key = ab.bar_key
        <where>
            bi.is_deleted = 0 and ab.bar_key is not null
            <if test="devkeys != null and devkeys.length > 0">
                and bi.dev_key in
                <foreach item="item" collection="devkeys" separator="," open="(" close=")" index="">
                    #{item}
                </foreach>
            </if>
        </where>
    </select>

    <select id="selectBoxPageList" resultType="cn.iocoder.yudao.module.bus.controller.admin.energyconsumption.VO.BusAisleBarQueryVO">
        SELECT
        bi.id AS id,
        bi.dev_key AS devKey,
        bi.ip_addr AS ipAddr,
        bi.cas_addr AS casAddr,
        bi.bar_id AS barId,
        bi.run_status AS runStatus,
        bi.node_ip AS nodeIp,
        concat(bi.bus_name,'-',bi.box_name) AS busName,
        bi.is_deleted AS isDeleted,
        bi.create_time AS createTime,
        bi.update_time AS updateTime,
        ab.aisle_id AS aisleId,
        ab.bar_key AS barKey,
        ab1.path AS path
        FROM
        box_index bi
        LEFT JOIN aisle_box ab ON bi.dev_key = ab.bar_key
        LEFT JOIN aisle_bar ab1 ON ab1.id = ab.aisle_bar_id
        <where>
            bi.is_deleted = 0 and ab.bar_key is not null
            <if test="devkeys != null and devkeys.length > 0">
                and bi.dev_key in
                <foreach item="item" collection="devkeys" separator="," open="(" close=")" index="">
                    #{item}
                </foreach>
            </if>
        </where>
    </select>
</mapper>